{"ast":null,"code":"import React,{useEffect}from'react';import{useNavigate,useSearchParams}from'react-router-dom';import{useAuth}from'../context/AuthContext';import{toast}from'sonner';import{getCurrentUser}from'../utils/authApi';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const OAuthCallback=()=>{const navigate=useNavigate();const[searchParams]=useSearchParams();const{setUser,setAccessToken,setRefreshToken}=useAuth();useEffect(()=>{const handleOAuthCallback=async()=>{const accessToken=searchParams.get('access_token');const refreshToken=searchParams.get('refresh_token');const error=searchParams.get('error');if(error){toast.error('Authentication failed',{description:'Could not sign in with Google. Please try again.'});navigate('/login');return;}if(!accessToken||!refreshToken){toast.error('Authentication failed',{description:'Invalid authentication response.'});navigate('/login');return;}try{// Store tokens\nlocalStorage.setItem('access_token',accessToken);localStorage.setItem('refresh_token',refreshToken);// Get user data\nconst userData=await getCurrentUser(accessToken);// Update auth context (if your context exposes these setters)\n// Otherwise, this will trigger the useEffect in AuthContext\ntoast.success('Successfully signed in!',{description:\"Welcome, \".concat(userData.username,\"!\")});// Redirect to director home\nsetTimeout(()=>{navigate('/director');},500);}catch(error){console.error('Error handling OAuth callback:',error);toast.error('Authentication failed',{description:'Could not complete sign in. Please try again.'});navigate('/login');}};handleOAuthCallback();},[searchParams,navigate]);return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center gradient-bg-dynamic\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center space-y-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted-foreground\",children:\"Completing sign in...\"})]})});};","map":{"version":3,"names":["React","useEffect","useNavigate","useSearchParams","useAuth","toast","getCurrentUser","jsx","_jsx","jsxs","_jsxs","OAuthCallback","navigate","searchParams","setUser","setAccessToken","setRefreshToken","handleOAuthCallback","accessToken","get","refreshToken","error","description","localStorage","setItem","userData","success","concat","username","setTimeout","console","className","children"],"sources":["/app/frontend/src/components/OAuthCallback.jsx"],"sourcesContent":["import React, { useEffect } from 'react';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport { toast } from 'sonner';\nimport { getCurrentUser } from '../utils/authApi';\n\nexport const OAuthCallback = () => {\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n  const { setUser, setAccessToken, setRefreshToken } = useAuth();\n\n  useEffect(() => {\n    const handleOAuthCallback = async () => {\n      const accessToken = searchParams.get('access_token');\n      const refreshToken = searchParams.get('refresh_token');\n      const error = searchParams.get('error');\n\n      if (error) {\n        toast.error('Authentication failed', {\n          description: 'Could not sign in with Google. Please try again.'\n        });\n        navigate('/login');\n        return;\n      }\n\n      if (!accessToken || !refreshToken) {\n        toast.error('Authentication failed', {\n          description: 'Invalid authentication response.'\n        });\n        navigate('/login');\n        return;\n      }\n\n      try {\n        // Store tokens\n        localStorage.setItem('access_token', accessToken);\n        localStorage.setItem('refresh_token', refreshToken);\n\n        // Get user data\n        const userData = await getCurrentUser(accessToken);\n        \n        // Update auth context (if your context exposes these setters)\n        // Otherwise, this will trigger the useEffect in AuthContext\n        \n        toast.success('Successfully signed in!', {\n          description: `Welcome, ${userData.username}!`\n        });\n\n        // Redirect to director home\n        setTimeout(() => {\n          navigate('/director');\n        }, 500);\n      } catch (error) {\n        console.error('Error handling OAuth callback:', error);\n        toast.error('Authentication failed', {\n          description: 'Could not complete sign in. Please try again.'\n        });\n        navigate('/login');\n      }\n    };\n\n    handleOAuthCallback();\n  }, [searchParams, navigate]);\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center gradient-bg-dynamic\">\n      <div className=\"text-center space-y-4\">\n        <div className=\"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto\"></div>\n        <p className=\"text-muted-foreground\">Completing sign in...</p>\n      </div>\n    </div>\n  );\n};\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,KAAQ,OAAO,CACxC,OAASC,WAAW,CAAEC,eAAe,KAAQ,kBAAkB,CAC/D,OAASC,OAAO,KAAQ,wBAAwB,CAChD,OAASC,KAAK,KAAQ,QAAQ,CAC9B,OAASC,cAAc,KAAQ,kBAAkB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAElD,MAAO,MAAM,CAAAC,aAAa,CAAGA,CAAA,GAAM,CACjC,KAAM,CAAAC,QAAQ,CAAGV,WAAW,CAAC,CAAC,CAC9B,KAAM,CAACW,YAAY,CAAC,CAAGV,eAAe,CAAC,CAAC,CACxC,KAAM,CAAEW,OAAO,CAAEC,cAAc,CAAEC,eAAgB,CAAC,CAAGZ,OAAO,CAAC,CAAC,CAE9DH,SAAS,CAAC,IAAM,CACd,KAAM,CAAAgB,mBAAmB,CAAG,KAAAA,CAAA,GAAY,CACtC,KAAM,CAAAC,WAAW,CAAGL,YAAY,CAACM,GAAG,CAAC,cAAc,CAAC,CACpD,KAAM,CAAAC,YAAY,CAAGP,YAAY,CAACM,GAAG,CAAC,eAAe,CAAC,CACtD,KAAM,CAAAE,KAAK,CAAGR,YAAY,CAACM,GAAG,CAAC,OAAO,CAAC,CAEvC,GAAIE,KAAK,CAAE,CACThB,KAAK,CAACgB,KAAK,CAAC,uBAAuB,CAAE,CACnCC,WAAW,CAAE,kDACf,CAAC,CAAC,CACFV,QAAQ,CAAC,QAAQ,CAAC,CAClB,OACF,CAEA,GAAI,CAACM,WAAW,EAAI,CAACE,YAAY,CAAE,CACjCf,KAAK,CAACgB,KAAK,CAAC,uBAAuB,CAAE,CACnCC,WAAW,CAAE,kCACf,CAAC,CAAC,CACFV,QAAQ,CAAC,QAAQ,CAAC,CAClB,OACF,CAEA,GAAI,CACF;AACAW,YAAY,CAACC,OAAO,CAAC,cAAc,CAAEN,WAAW,CAAC,CACjDK,YAAY,CAACC,OAAO,CAAC,eAAe,CAAEJ,YAAY,CAAC,CAEnD;AACA,KAAM,CAAAK,QAAQ,CAAG,KAAM,CAAAnB,cAAc,CAACY,WAAW,CAAC,CAElD;AACA;AAEAb,KAAK,CAACqB,OAAO,CAAC,yBAAyB,CAAE,CACvCJ,WAAW,aAAAK,MAAA,CAAcF,QAAQ,CAACG,QAAQ,KAC5C,CAAC,CAAC,CAEF;AACAC,UAAU,CAAC,IAAM,CACfjB,QAAQ,CAAC,WAAW,CAAC,CACvB,CAAC,CAAE,GAAG,CAAC,CACT,CAAE,MAAOS,KAAK,CAAE,CACdS,OAAO,CAACT,KAAK,CAAC,gCAAgC,CAAEA,KAAK,CAAC,CACtDhB,KAAK,CAACgB,KAAK,CAAC,uBAAuB,CAAE,CACnCC,WAAW,CAAE,+CACf,CAAC,CAAC,CACFV,QAAQ,CAAC,QAAQ,CAAC,CACpB,CACF,CAAC,CAEDK,mBAAmB,CAAC,CAAC,CACvB,CAAC,CAAE,CAACJ,YAAY,CAAED,QAAQ,CAAC,CAAC,CAE5B,mBACEJ,IAAA,QAAKuB,SAAS,CAAC,mEAAmE,CAAAC,QAAA,cAChFtB,KAAA,QAAKqB,SAAS,CAAC,uBAAuB,CAAAC,QAAA,eACpCxB,IAAA,QAAKuB,SAAS,CAAC,0FAA0F,CAAM,CAAC,cAChHvB,IAAA,MAAGuB,SAAS,CAAC,uBAAuB,CAAAC,QAAA,CAAC,uBAAqB,CAAG,CAAC,EAC3D,CAAC,CACH,CAAC,CAEV,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}