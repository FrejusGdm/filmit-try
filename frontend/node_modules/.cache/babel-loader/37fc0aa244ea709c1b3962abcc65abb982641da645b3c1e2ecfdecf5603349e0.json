{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import{loginUser,registerUser,refreshAccessToken,logoutUser,getCurrentUser}from'../utils/authApi';import{toast}from'sonner';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(null);export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[accessToken,setAccessToken]=useState(localStorage.getItem('access_token'));const[refreshToken,setRefreshToken]=useState(localStorage.getItem('refresh_token'));// Load user on mount if tokens exist\nuseEffect(()=>{const initAuth=async()=>{if(accessToken){try{const userData=await getCurrentUser(accessToken);setUser(userData);}catch(error){// Token might be expired, try to refresh\nif(refreshToken){try{const newTokens=await refreshAccessToken(refreshToken);setAccessToken(newTokens.access_token);setRefreshToken(newTokens.refresh_token);localStorage.setItem('access_token',newTokens.access_token);localStorage.setItem('refresh_token',newTokens.refresh_token);const userData=await getCurrentUser(newTokens.access_token);setUser(userData);}catch(refreshError){// Refresh failed, clear everything\nlogout();}}else{logout();}}}setLoading(false);};initAuth();},[]);const login=async(email,password)=>{try{const tokens=await loginUser(email,password);setAccessToken(tokens.access_token);setRefreshToken(tokens.refresh_token);localStorage.setItem('access_token',tokens.access_token);localStorage.setItem('refresh_token',tokens.refresh_token);const userData=await getCurrentUser(tokens.access_token);setUser(userData);toast.success('Login successful!',{description:'Welcome back to Trendle'});return{success:true};}catch(error){var _error$response,_error$response$data;const errorMessage=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.detail)||'Login failed';toast.error('Login failed',{description:errorMessage});return{success:false,error:errorMessage};}};const register=async(username,email,password)=>{try{const tokens=await registerUser(username,email,password);setAccessToken(tokens.access_token);setRefreshToken(tokens.refresh_token);localStorage.setItem('access_token',tokens.access_token);localStorage.setItem('refresh_token',tokens.refresh_token);const userData=await getCurrentUser(tokens.access_token);setUser(userData);toast.success('Registration successful!',{description:'Welcome to Trendle'});return{success:true};}catch(error){var _error$response2,_error$response2$data;const errorMessage=((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.detail)||'Registration failed';toast.error('Registration failed',{description:errorMessage});return{success:false,error:errorMessage};}};const logout=async()=>{try{if(accessToken){await logoutUser(accessToken);}}catch(error){// Logout anyway even if API call fails\n}finally{setUser(null);setAccessToken(null);setRefreshToken(null);localStorage.removeItem('access_token');localStorage.removeItem('refresh_token');localStorage.removeItem('isLoggedIn');toast.success('Logged out successfully');}};const value={user,loading,accessToken,isAuthenticated:!!user,login,register,logout};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","loginUser","registerUser","refreshAccessToken","logoutUser","getCurrentUser","toast","jsx","_jsx","AuthContext","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","loading","setLoading","accessToken","setAccessToken","localStorage","getItem","refreshToken","setRefreshToken","initAuth","userData","error","newTokens","access_token","refresh_token","setItem","refreshError","logout","login","email","password","tokens","success","description","_error$response","_error$response$data","errorMessage","response","data","detail","register","username","_error$response2","_error$response2$data","removeItem","value","isAuthenticated","Provider"],"sources":["/app/frontend/src/context/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport { loginUser, registerUser, refreshAccessToken, logoutUser, getCurrentUser } from '../utils/authApi';\nimport { toast } from 'sonner';\n\nconst AuthContext = createContext(null);\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [accessToken, setAccessToken] = useState(localStorage.getItem('access_token'));\n  const [refreshToken, setRefreshToken] = useState(localStorage.getItem('refresh_token'));\n\n  // Load user on mount if tokens exist\n  useEffect(() => {\n    const initAuth = async () => {\n      if (accessToken) {\n        try {\n          const userData = await getCurrentUser(accessToken);\n          setUser(userData);\n        } catch (error) {\n          // Token might be expired, try to refresh\n          if (refreshToken) {\n            try {\n              const newTokens = await refreshAccessToken(refreshToken);\n              setAccessToken(newTokens.access_token);\n              setRefreshToken(newTokens.refresh_token);\n              localStorage.setItem('access_token', newTokens.access_token);\n              localStorage.setItem('refresh_token', newTokens.refresh_token);\n              \n              const userData = await getCurrentUser(newTokens.access_token);\n              setUser(userData);\n            } catch (refreshError) {\n              // Refresh failed, clear everything\n              logout();\n            }\n          } else {\n            logout();\n          }\n        }\n      }\n      setLoading(false);\n    };\n\n    initAuth();\n  }, []);\n\n  const login = async (email, password) => {\n    try {\n      const tokens = await loginUser(email, password);\n      setAccessToken(tokens.access_token);\n      setRefreshToken(tokens.refresh_token);\n      localStorage.setItem('access_token', tokens.access_token);\n      localStorage.setItem('refresh_token', tokens.refresh_token);\n\n      const userData = await getCurrentUser(tokens.access_token);\n      setUser(userData);\n      \n      toast.success('Login successful!', {\n        description: 'Welcome back to Trendle'\n      });\n      return { success: true };\n    } catch (error) {\n      const errorMessage = error.response?.data?.detail || 'Login failed';\n      toast.error('Login failed', {\n        description: errorMessage\n      });\n      return { success: false, error: errorMessage };\n    }\n  };\n\n  const register = async (username, email, password) => {\n    try {\n      const tokens = await registerUser(username, email, password);\n      setAccessToken(tokens.access_token);\n      setRefreshToken(tokens.refresh_token);\n      localStorage.setItem('access_token', tokens.access_token);\n      localStorage.setItem('refresh_token', tokens.refresh_token);\n\n      const userData = await getCurrentUser(tokens.access_token);\n      setUser(userData);\n      \n      toast.success('Registration successful!', {\n        description: 'Welcome to Trendle'\n      });\n      return { success: true };\n    } catch (error) {\n      const errorMessage = error.response?.data?.detail || 'Registration failed';\n      toast.error('Registration failed', {\n        description: errorMessage\n      });\n      return { success: false, error: errorMessage };\n    }\n  };\n\n  const logout = async () => {\n    try {\n      if (accessToken) {\n        await logoutUser(accessToken);\n      }\n    } catch (error) {\n      // Logout anyway even if API call fails\n    } finally {\n      setUser(null);\n      setAccessToken(null);\n      setRefreshToken(null);\n      localStorage.removeItem('access_token');\n      localStorage.removeItem('refresh_token');\n      localStorage.removeItem('isLoggedIn');\n      toast.success('Logged out successfully');\n    }\n  };\n\n  const value = {\n    user,\n    loading,\n    accessToken,\n    isAuthenticated: !!user,\n    login,\n    register,\n    logout\n  };\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}